<h4 class="center h-3-spacing white-text"><%= homework.title %></h4>
<% if teacher? %>
  <div class="row">
    <div class="col s10">
      <%= link_to teacher_student_homeworks_path(homework.user),
                  class: "btn-floating waves-effect waves-light brand-bg-lt-grey" do %>
        <i class="material-icons">skip_previous</i>
      <% end %>
      <span class="button-text white-text">back to <%= homework.user.name %>'s work</span>
    </div>
  </div>
<% end %>
<div class="row">
  <div class="col s12">
    <div class="card-panel hoverable white-text thin">
      <% if current_user.role == "T" %>
        <div class="right">
          <a class="btn-floating btn-Small waves-effect waves-light brand-bg-grey"
             onclick="editHomeworkNote(<%= homework.user.id %>,<%= homework.id %>)">
             <i class="Tiny material-icons">edit</i>
          </a>
        </div>
      <% end %>
      <h5 class="button-spacing"><strong>Notes from lesson</strong></h5>
      <p><%= homework.note %></p>
      <h5 class="button-spacing"><strong>Tasks for the homework</strong></h5>
      <div class="button-spacing thin">
        <ul class="collection">
          <% homework.tasks.each do |task| %>
            <li class="collection-item white-text">
              <% if current_user.role == 'S' %>
                <div class="right">
                  <input class="toggle-task-status filled-in"
                         type="checkbox"
                         name="<%= task.id %>"
                         id="<%= task.id %>"
                         <%= if task.complete then "checked" end %> >
                           <label class="check-box" for="<%= task.id %>"></label>
                </div>
              <% elsif task.complete %>
                <i class="material-icons right done-icon">done_all</i>
              <% end %>
              <blockquote>
                <p class="">
                <strong><%= task.item %></strong> <br>
                <%= youtubify(task.url) %>
                </p>
              </blockquote>
            </li>
          <% end %>
        </ul>
        <% if current_user.role == "T" %>
          <div class="row">
            <a class="btn-floating waves-effect waves-light brand-bg-green"
               type="button" onclick="addTask(<%= @student.id %>,<%= homework.id %>)">
               <i class="material-icons md-18">add</i>
            </a>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col s12 white-text">
    <% homework.comments.each do |comment| %>
      <div class="card panel comment-padding hoverable">
        <h5><%= comment.feedback %></h5>
        <p class="comment-name">---<%= comment.user.name %></p>
        <% if comment.url and comment.url != "" %>
          <%= youtubify(comment.url) %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<script>
$(".toggle-task-status").on('click', function() {
  $.ajax({
    url: "<%= url_for controller: '/tasks', action: 'update' %>",
    method: "PUT",
    data: {
      homework_id: "<%= homework.id %>",
      task_id: $(this).attr("name"),
      done: this.checked ? true : false
    }
  });
});

function editHomeworkNote(student, homework) {
    window.location = "/teacher/students/" + student + "/homeworks/" + homework + "/edit"
    console.log("editing " + homework + " of " + student);
}

function addTask(student, homework) {
  //    console.log("redirecting to : /teacher/students/" + student + "/homework/new?homework=" + homework)
  window.location = "/teacher/students/" + student + "/homework/new?homework=" + homework;
}
</script>
